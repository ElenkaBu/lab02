## 1. Цели
* Настроить OSPF в Underlay сети, для IP связанности между всеми устройствами NXOS;

#### Схема сети

![Underlay_ospf.PNG](Underlay_ospf.PNG)

<details> 

<summary> Теория </summary>

```

Описание протокола OSPF:
• Link-state
• RFC 2328 (основной), OSPF Version 2 /RFC 5340, OSPF for IPv6
• Protocol 89
• IPv4 224.0.0.5 - all spf routers / 224.0.0.6 – all DR/BDR routers
• IPv6 FF02::5 - neighbor discovery /all spf routers
• Метрика основна на Interface bandwidth
• Использует алгоритм Дейкстры для построения кратчайшего пути

OSPF Adjacency:
• RID должны быть разными у двух устройств
• У соседей должны совпадать сеть и маска сети
• MTU
• Area ID для сегмента
• Hello and Dead timers в сегменте
• Authentication параметры для сегмента
• Stub area flag — должен быть одинаковый

OSPF  в CLOS (задачи в Underlay):
- Доставка маршрутной информации
- Быстрая сходимость (+ BFD)
- Масштабируемость (до 300 роутеров в backbone)
- Поддержка большого количества префиксов
- Мультипротокольное использование (IPv4&IPv6)
- Распределение балансировки (ECMP)
- Удобство автоматизации
добавлять пока не кончатся порты на спайнах. Добавлением спайна можно расширить аплинки лифов.

Рекомендации:
• Использовать point-to-point на интерфейсах
• Указывать RID в явном виде
• Passive-interface default
• Один номер area для каждого pod
• Использовать ip ospf area вместо network (Cisco Nexus specific)
• Использовать BFD
• Избегать использования redistribute
• Применять минимально необходимую конфигурацию OSPF
• Настраивать OSPF adjacency в GRT (не делать underlay внутри vrf)
• Настройка аутентификации

```

</details>

## 2. Адресное пространство для Underlay сети:

#### Адресация интерфейсов на Spine и Leaf:

| Наименование |   Адрес   |      Маска      |    Интерфейс    |
| :----------- |:---------:|  :------------: |  :------------: |
| Spine1       | 10.0.0.1  | 255.255.255.252 |    Ethernet1/1  |
| Spine1       | 10.0.0.9  | 255.255.255.252 |    Ethernet1/2  | 
| Spine1       | 10.0.0.17 | 255.255.255.252 |    Ethernet1/3  | 
| Spine2       | 10.0.0.5  | 255.255.255.252 |    Ethernet1/1  |
| Spine2       | 10.0.0.13 | 255.255.255.252 |    Ethernet1/2  | 
| Spine2       | 10.0.0.21 | 255.255.255.252 |    Ethernet1/3  | 
| Leaf1        | 10.0.0.2  | 255.255.255.252 |    Ethernet1/1  |
| Leaf1        | 10.0.0.6  | 255.255.255.252 |    Ethernet1/2  | 
| Leaf2        | 10.0.0.10 | 255.255.255.252 |    Ethernet1/1  |
| Leaf2        | 10.0.0.14 | 255.255.255.252 |    Ethernet1/2  | 
| Leaf3        | 10.0.0.18 | 255.255.255.252 |    Ethernet1/1  |
| Leaf3        | 10.0.0.22 | 255.255.255.252 |    Ethernet1/2  | 

#### Анонсируемые сети:

| Наименование | Rouer ID |                       Анонсируемые сети                    |
| :----------- |:--------:| :---------------------------------------------------------:|
| Spine1       |  1.1.1.1 | 10.0.0.0/30, 10.0.0.8/30, 10.0.0.16/30                     |
| Spine2       |  2.2.2.2 | 10.0.0.4/30, 10.0.0.12/30, 10.0.0.20/30                    |
| Leaf1        |  3.3.3.3 | 10.0.0.0/30, 10.0.0.4/30, 192.168.1.0/24                   |
| Leaf2        |  4.4.4.4 | 10.0.0.8/30, 10.0.0.12/30, 192.168.2.0/24                  |
| Leaf3        |  5.5.5.5 | 10.0.0.16/30, 10.0.0.20/30, 192.168.3.0/24, 192.168.4.0/24 |

#### Адреса хостов:

|  Хост |     Адрес      |
| :---- |:--------------:|
| Host1 | 192.168.1.2/24 |
| Host2 | 192.168.2.2/24 |
| Host3 | 192.168.3.2/24 |
| Host4 | 192.168.4.2/24 |

## 3. Схема и настройка

![lab02.PNG](lab02.PNG)

#### Настройка Spine1:

![Spine1_cfg.PNG](Spine1_cfg.PNG)

#### Настройка Spine2:

![Spine2_cfg.PNG](Spine2_cfg.PNG)

#### Настройка Leaf1:

![Leaf1_cfg.PNG](Leaf1_cfg.PNG)

#### Настройка Leaf2:

![Leaf2_cfg.PNG](Leaf2_cfg.PNG)

#### Настройка Leaf3:

![Leaf3_cfg.PNG](Leaf3_cfg.PNG)








